{% extends "base.html" %}

{% block title %}Gallery | Art by CK{% endblock %}
{% block body_class %}gallery-background{% endblock %}

{% block content %}
<section class="container mt-5">
  <div class="row justify-content-center text-center">
    <div class="col-lg-8">
      {% comment %} <h1 class="display-5 fw-semibold mb-3">Gallery</h1> {% endcomment %}
    </div>
  </div>
  <div class="row justify-content-center my-4">
    <div class="col-lg-8 d-flex flex-column flex-md-row align-items-center justify-content-center gap-3 gallery-controls">
      <span class="text-uppercase small fw-semibold letter-spacing-sm">Columns</span>
      <div class="btn-group" role="group" aria-label="Choose gallery column count">
        <input type="radio" class="btn-check" name="gallery-columns" id="gallery-columns-3" value="3" autocomplete="off">
        <label class="btn btn-outline-dark" for="gallery-columns-3">3</label>

        <input type="radio" class="btn-check" name="gallery-columns" id="gallery-columns-4" value="4" autocomplete="off" checked>
        <label class="btn btn-outline-dark" for="gallery-columns-4">4</label>

        <input type="radio" class="btn-check" name="gallery-columns" id="gallery-columns-5" value="5" autocomplete="off">
        <label class="btn btn-outline-dark" for="gallery-columns-5">5</label>
      </div>
    </div>
  </div>
</section>
<section class="container-fluid px-4 px-xl-5 text-center">
  <h2 class="lead mb-4 cedarville-cursive-regular display-5 rounded-1 d-inline-block px-3 py-2 gallery-quote">I am a mother artist.</h2>
</section>
{% include "inserts/gallery_grid.html" %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const grid = document.querySelector('.gallery-grid[data-masonry]');
    const columnInputs = document.querySelectorAll('input[name="gallery-columns"]');

    if (!grid) {
      return;
    }

    const getMasonryInstance = () =>
      window.Masonry && window.Masonry.data ? window.Masonry.data(grid) : null;

    const relayout = () => {
      const instance = getMasonryInstance();
      if (instance) {
        instance.layout();
      }
    };

    const watchImages = () => {
      if (window.imagesLoaded) {
        window.imagesLoaded(grid, relayout);
      } else {
        grid.querySelectorAll('img').forEach((img) => {
          if (img.complete) {
            return;
          }
          img.addEventListener('load', relayout, { once: true });
          img.addEventListener('error', relayout, { once: true });
        });
      }
    };

    const applyColumns = (cols) => {
      grid.dataset.cols = cols;
      relayout();
    };

    columnInputs.forEach((input) => {
      input.addEventListener('change', () => {
        if (input.checked) {
          applyColumns(input.value);
          watchImages();
        }
      });
    });

    const initialize = () => {
      const checked = document.querySelector('input[name="gallery-columns"]:checked');
      applyColumns(checked ? checked.value : 3);
      watchImages();
    };

    if (document.readyState === 'complete') {
      initialize();
    } else {
      window.addEventListener('load', initialize, { once: true });
    }
  });
</script>
{% endblock %}
